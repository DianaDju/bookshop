(()=>{"use strict";let t=JSON.parse(localStorage.getItem("bookshop_cart"))||[];function e(){const e=document.querySelector(".cart-badge");e&&(e.textContent=t.length,e.style.display=t.length>0?"flex":"none")}const n={currentCategory:"Architecture",startIndex:0,maxResults:6},o={booksGrid:document.getElementById("books-grid"),loadMoreBtn:document.getElementById("load-more-btn"),categoryItems:document.querySelectorAll(".category-item"),navLinks:document.querySelectorAll(".nav-list a")};async function a(a=!1){a||(o.booksGrid.innerHTML="");const s=await async function(t,e=0,n=6){const o=`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(`subject:${t}`)}&key=AIzaSyCXUkWkuTWmCsEI15tGS-9qrmoDMf8Hqas&printType=books&startIndex=${e}&maxResults=${n}&langRestrict=en`;try{const t=await fetch(o);if(!t.ok)throw new Error("Ошибка API");return await t.json()}catch(t){return console.error("Ошибка при получении книг:",t),null}}(n.currentCategory,n.startIndex);var r,c;s&&s.items?(r=s.items,c=o.booksGrid,r.forEach((n,o)=>{const a=n.volumeInfo,s=n.id,r=t.includes(s),i=a.imageLinks?a.imageLinks.thumbnail:"https://placehold.jp/24/eeeeee/999999/212x300.png?text=No%20Cover",l=n.saleInfo,d=l&&l.retailPrice&&l.retailPrice.amount?`<p class="book-card__price">${l.retailPrice.amount} ${l.retailPrice.currencyCode}</p>`:"",u=document.createElement("div");u.className="book-card",u.style.animationDelay=.1*o+"s",u.innerHTML=`\n            <div class="book-card__image"><img src="${i}" alt="${a.title}"></div>\n            <div class="book-card__info">\n                <p class="book-card__author">${a.authors?.join(", ")||"Unknown"}</p>\n                <h3 class="book-card__title">${a.title}</h3>\n                <div class="book-card__rating">\n                    ${function(t){if(!t)return"";let e='<div class="stars">';for(let n=1;n<=5;n++)n<=Math.floor(t)?e+="★":e+='<span style="color: #E0E0E0">★</span>';return e+="</div>",e}(a.averageRating)}\n                    <span class="reviews-count">${a.ratingsCount||0} reviews</span>\n                </div>\n                <p class="book-card__description">${a.description||"No description."}</p>\n                \n                ${d} <button class="book-card__buy-btn ${r?"in-cart":""}">\n                    ${r?"In the cart":"Buy now"}\n                </button>\n            </div>\n        `;const m=u.querySelector(".book-card__buy-btn");m.addEventListener("click",()=>{const n=function(e){const n=t.indexOf(e);return-1===n?(t.push(e),!0):(t.splice(n,1),!1)}(s);m.textContent=n?"In the cart":"Buy now",m.classList.toggle("in-cart",n),localStorage.setItem("bookshop_cart",JSON.stringify(t)),e()}),c.appendChild(u)}),o.loadMoreBtn.style.display="block"):o.loadMoreBtn.style.display="none"}o.categoryItems.forEach(t=>{t.addEventListener("click",()=>{o.categoryItems.forEach(t=>t.classList.remove("active")),t.classList.add("active"),n.currentCategory=t.getAttribute("data-category"),n.startIndex=0,a()})}),o.loadMoreBtn.addEventListener("click",()=>{n.startIndex+=n.maxResults,a(!0)}),o.navLinks.forEach(t=>{t.addEventListener("click",t=>{o.navLinks.forEach(t=>t.classList.remove("active")),t.currentTarget.classList.add("active")})}),e(),a(),function(){const t=document.querySelectorAll(".slide"),e=document.querySelectorAll(".dot");let n=0;function o(n){t.forEach(t=>t.classList.remove("active")),e.forEach(t=>t.classList.remove("active")),t[n].classList.add("active"),e[n].classList.add("active")}0!==t.length&&0!==e.length&&(e.forEach((t,e)=>{t.addEventListener("click",()=>{n=e,o(n)})}),setInterval(()=>{n=(n+1)%t.length,o(n)},5e3))}()})();